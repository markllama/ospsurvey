#!/bin/env python
from __future__ import print_function
"""
Report the storage use of all systems in a cloud
"""

import json
import subprocess

def get_all_projects():
  project_string = subprocess.check_output("openstack project list -f json".split())
  projects = json.loads(project_string)

  return projects
  

if __name__ == "__main__":

  projects = get_all_projects()
  servers = {}
  for project in projects:
    # servers[project['Name']] =
    servers_string = subprocess.check_output("openstack server list --project {} -f json".format(project['Name']).split())
    servers[project['Name']] = json.loads(servers_string)
    
    
  print(json.dumps(servers))
